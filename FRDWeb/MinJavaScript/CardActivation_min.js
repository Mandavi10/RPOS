var id = "", List_Array = [], comp_Array = [], dataCompany = []; function BindRestroData() { var restroid = id; jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/CustomerLoyalty/BindRestroData", data: "{'restroid':'" + restroid + "'}", dataType: "json", async: !1, success: function (result) { var i = 0, jsondata = eval(result), totalcount = result.Table1[0].coun, cardcount = result.Table3[0].count; jquery_min_p("#lbltotalcount").text(totalcount), jquery_min_p("#lblcardcount").text(cardcount) }, error: function (r) { jquery_min_p("#hwarning").text("Their is problem,Try Again"), jquery_min_p("#WarningPopup").modal("show") } }) } function checkcardno() { var cardno = jquery_min_p("#txtcacardno").val().replace("'", "\\'"); jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/CustomerLoyalty/checkcardno", data: "{'cardno':'" + cardno + "'}", dataType: "json", async: !1, success: function (result) { var IsItem = 0, i = 0, jsondata = eval(result), Query = ""; if (Query += "<table style='width: 98%;margin-left: 1%;'>", "1" == result[0].Column1) { jquery_min_p("#divcardnodisplay").html(""); var ArrayLenght = List_Array.length; if ("" != List_Array) for (var i = 0; i < ArrayLenght; i++) cardno == List_Array[i] && (jquery_min_p("#hwarning").text("Card Already Selected"), jquery_min_p("#WarningPopup").modal("show"), jquery_min_p("#WarningPopuptbody").block(), IsItem = 1); 0 == IsItem && List_Array.push(cardno); for (var i = 0; i < List_Array.length; i++) { Query += "<tr>", Query = Query + "<td>" + List_Array[i] + "</td>"; var test = List_Array[i]; Query += "<td onclick='Delete(this)'><i class='fa fa-trash fafadelete pull-right' aria-hidden='true'></i></td>", Query += "</tr>" } Query += "</table>", jquery_min_p("#divcardnodisplay").append(Query), console.log(List_Array), jquery_min_p("#txtcacardno").val("") } else jquery_min_p("#hwarning").text("Card already Exists"), jquery_min_p("#WarningPopup").modal("show"), jquery_min_p("#txtcacardno").val("") }, error: function (r) { jquery_min_p("#popupsuccess").text("There is a Problem, Try Again!"), jquery_min_p("#savePopup").modal("show") } }) } function saveCardActivation() { var r = 0; jquery_min_p("#divcardnodisplay tr").each(function (t) { "" != jquery_min_p(this).closest("tr").find("td:nth-child(1)").text() && (r = 1) }); var t = "<dtXml>", a = (jquery_min_p("#txtcacardno").val(), id); jquery_min_p("#divcardnodisplay tr").each(function (r) { var a = jquery_min_p(this).closest("tr"); t += "<dtXml "; var n = a.find("td:nth-child(1)").text(); t += 'cardNo="' + n + '" ', t += " />" }), t += "</dtXml>", 1 == r ? jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/CustomerLoyalty/saveCardActivation", data: "{'TableDataX':'" + t + "','restroId':'" + a + "'}", dataType: "json", async: !1, success: function (r) { "1" == r[0].result ? (jquery_min_p("#txtcacardno").val(""), jquery_min_p("#popupsuccess").text("Card Activated Successfully"), jquery_min_p("#savePopup").modal("show")) : alert("Error") }, error: function () { } }) : (jquery_min_p("#hwarning").text("Insert Card"), jquery_min_p("#WarningPopup").modal("show")) } function Delete(r) { var t = ""; jquery_min_p("#divcardnodisplay tbody tr ").each(function (a) { t = jquery_min_p(r).closest("tr").text(), jquery_min_p(r).closest("tr").remove() }), console.log(t); var a = List_Array.indexOf(t); a > -1 && List_Array.splice(a, 1) } jquery_min_p(document).ready(function () { id = jquery_min_p("#lblrestroid").text(), BindRestroData(), jquery_min_p("#txtcacardno").change(function () { checkcardno() }), jquery_min_p("#btncardsaveclose").click(function () { jquery_min_p("#cardsavePopup").modal("hide") }), jquery_min_p("#btncardactivate").click(function () { var r = 0; jquery_min_p("#divcardnodisplay tr").each(function (t) { "" != jquery_min_p(this).closest("tr").find("td:nth-child(1)").text() && (r = 1) }), 1 == r ? (jquery_min_p("#hconfirm").text("Are You Sure Want To Activate !"), jquery_min_p("#confirmationPopup").modal("show")) : (jquery_min_p("#hwarning").text("Insert Card"), jquery_min_p("#WarningPopup").modal("show")) }), jquery_min_p("#yesBtn").click(function () { jquery_min_p("#confirmationPopup").modal("hide"), saveCardActivation(), List_Array.splice(0, List_Array.length), jquery_min_p("#divcardnodisplay").html(""), BindRestroData() }), jquery_min_p("#btnok").click(function () { jquery_min_p("#WarningPopup").css("none") }) });
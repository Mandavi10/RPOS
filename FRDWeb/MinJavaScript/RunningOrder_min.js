var restroid = "", checkOrderId = "", checkOrderTypeId = "", IsHoldItem = 0; function BindRunningOrder() { restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p("#divrunningorder").html(""), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BindRunningOrder", data: "{'restroid':'" + restroid + "'}", dataType: "json", async: !1, success: function (e) { var r = 0, i = e.length, t = "", n = "", d = "", l = ""; jquery_min_p("#empDetails").css("display", "block"); for (r = 0; r < i; r++) 0 == r && (n = e[r].orderId, d = e[r].OrderNo, l = e[r].ordertypeId), "1" == e[r].ordertypeId ? "" == e[r].OrderNo ? (t = (t += "<div class='width30 orderbrd ml-3 mt-1'>") + "<div class='col-md-12 hold height37' id='" + e[r].orderId + "' onclick='BindOrderDraft(" + e[r].orderId + ',"' + e[r].ordertypeId + "\");'>", t = (t += "<div class='row'>") + "<label class='col-md-12 fontBold pl-0 mt-2' style='text-align: center;'>" + e[r].TableNo + "</label>", t += "</div>", t += "</div>", t += "<div class='col-md-12'>", t += "<div class='row orderheadling'>", t = (t += "<label class='col-md-6 fontBold' style='color:#fff'>Order No.:</label>") + "<label class='col-md-6 p-0' style='color:#fff'>" + e[r].OrderNo + "</label>", t += "</div>", t += "</div>", t += "</div>") : (t = t + "<div class='width30 orderbrd ml-3 mt-1' onclick='BindOrderDetail(" + e[r].orderId + ',"' + e[r].OrderNo + '","' + e[r].ordertypeId + "\");'>", t += "<div class='col-md-12 dinein height37'>", t = (t += "<div class='row'>") + "<label class='col-md-12 fontBold pl-0 mt-2' style='text-align: center;'>" + e[r].TableNo + "</label>", t += "</div>", t += "</div>", t += "<div class='col-md-12'>", t += "<div class='row orderheadling'>", t = (t += "<label class='col-md-6 fontBold' style='color:#fff'>Order No.:</label>") + "<label class='col-md-6 p-0' style='color:#fff'>" + e[r].OrderNo + "</label>", t += "</div>", t += "</div>", t += "</div>") : "3" == e[r].ordertypeId && (t = t + "<div class='width30 orderbrd ml-3 mt-1' onclick='BindOrderDetail(" + e[r].orderId + ',"' + e[r].OrderNo + '","' + e[r].ordertypeId + "\");'>", t += "<div class='col-md-12 kitchenordercard height37'>", t += "<div class='row'>", t += "<label class='col-md-12 fontBold pl-0 mt-2' style='text-align: center;'>Take Away</label>", t += "</div>", t += "</div>", t += "<div class='col-md-12'>", t += "<div class='row orderheadling'>", t = (t += "<label class='col-md-6 fontBold' style='color:#fff'>Order No.:</label>") + "<label class='col-md-6 p-0' style='color:#fff'>" + e[r].OrderNo + "</label>", t += "</div>", t += "</div>", t += "</div>"); jquery_min_p("#divrunningorder").append(t), BindOrderDetail(n, d, l), jquery_min_p("#preloader").css("display", "none"), jquery_min_p("#Overlay_Load").css("visibility", "hidden") }, beforesend: function () { jquery_min_p("#preloader").css("display", "block"), jquery_min_p("#Overlay_Load").css("visibility", "visible") }, error: function () { } }) } function BindOrderDraft(e, r) { var i = "#" + e; jquery_min_p(i).removeClass("hold"), jquery_min_p(i).addClass("active"), IsHoldItem = 1, checkOrderId = e, jquery_min_p("#btntableshift").css("display", "inline-block"), checkOrderTypeId = r, jquery_min_p("#lblOrderNo").text("OrderNo.-: "), jquery_min_p("#divorderdeatil").css("display", "block"); var t = e; restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p("#lblorderid").val(e), jquery_min_p("#tblrunningord tbody").html(""), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/Bindholditems", data: "{'restroid':'" + restroid + "','OrderId':'" + t + "'}", dataType: "json", async: !1, success: function (e) { var r = 0, i = e.Table, t = (e.Table1, e.Table2), n = 0, d = "", l = i.length, o = 0, a = 0, s = 0; for (r = 0; r < i.length; r++) d = (d = (d = (d = (d += "<tr>") + "<td style='display:none'>" + i[r].orderitemsId + "</td>") + "<td>" + i[r].ItemName + "</td>") + "<td>" + i[r].Qty + "</td>") + "<td>" + i[r].Status + "</td>", d += "<td>-</td>", d += "<td>-</td>", d += "</tr>", n += i[r].Price, "Preparing" == i[r].Status && (a += 1), "Bumped" == i[r].Status && (o += 1), "Delivered" == i[r].Status && (s += 1), "Settled" == i[r].Status && (s += 1); var c = t[0].TableNo; jquery_min_p("#lblPreTable").text(c), jquery_min_p("#lblorder").text(l), jquery_min_p("#lblcooking").text(a), jquery_min_p("#lblBumped").text(o), jquery_min_p("#lbldilivered").text(s), jquery_min_p("#tblrunningord tbody").append(d), jquery_min_p("#lblTotalSAR").text(n), jquery_min_p("#tempbill").css("display", "none"), jquery_min_p("#btnSettle").css("display", "none"), jquery_min_p("#preloader").css("display", "none"), jquery_min_p("#Overlay_Load").css("visibility", "hidden") }, beforesend: function () { jquery_min_p("#preloader").css("display", "block"), jquery_min_p("#Overlay_Load").css("visibility", "visible") }, error: function () { } }) } function BindOrderDetail(e, r, i) { var t = r; checkOrderId = e, IsHoldItem = 0, jquery_min_p("#lblOrderNo").text("OrderNo.-: " + t), "3" == i ? (jquery_min_p("#btntableshift").css("display", "none"), checkOrderTypeId = i) : (jquery_min_p("#btntableshift").css("display", "inline-block"), checkOrderTypeId = i), jquery_min_p("#divorderdeatil").css("display", "block"); var n = e; restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p("#lblorderid").val(e), jquery_min_p("#tblrunningord tbody").html(""), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BindOrderDetail", data: "{'restroid':'" + restroid + "','OrderId':'" + n + "'}", dataType: "json", async: !1, success: function (e) { var r = 0, i = e.Table, t = (e.Table1, e.Table2), n = 0, d = "", l = i.length, o = 0, a = 0, s = 0; for (r = 0; r < i.length; r++) d = (d = (d = (d = (d = (d = (d += "<tr>") + "<td style='display:none'>" + i[r].orderitemsId + "</td>") + "<td>" + i[r].ItemName + "</td>") + "<td>" + i[r].Quantity + "</td>") + "<td>" + i[r].Status + "</td>") + "<td>" + i[r].KOTId + "</td>") + "<td class='ids' onclick='Action_Click(" + i[r].orderitemsId + ',"' + i[r].Status + "\");'><i class='fa fa-paper-plane action' aria-hidden='true'></i></td>", d += "</tr>", n += i[r].Price, "Preparing" == i[r].Status && (a += 1), "Bumped" == i[r].Status && (o += 1), "Delivered" == i[r].Status && (s += 1), "Settled" == i[r].Status && (s += 1); var c = t[0].TableNo, p = t[0].OrderNo; jquery_min_p("#lblPreTable").text(c), jquery_min_p("#lblorderIdDineIn").text(p), jquery_min_p("#lblorder").text(l), jquery_min_p("#lblcooking").text(a), jquery_min_p("#lblBumped").text(o), jquery_min_p("#lbldilivered").text(s), jquery_min_p("#tblrunningord tbody").append(d), jquery_min_p("#lblTotalSAR").text(n), jquery_min_p("#preloader").css("display", "none"), jquery_min_p("#Overlay_Load").css("visibility", "hidden") }, beforesend: function () { jquery_min_p("#preloader").css("display", "block"), jquery_min_p("#Overlay_Load").css("visibility", "visible") }, error: function () { } }) } function BtnTableShift_Click() { var e = jquery_min_p("#lblorderid").val(); restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BtnTableShift_Click", data: "{'restroid':'" + restroid + "','orderId':'" + e + "'}", dataType: "json", async: !1, success: function (e) { e.length; Bindtable(e.Table1[0].sittingsectionId) }, error: function () { } }) } function Bindtable(e) { restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p("#sourceFields").html(""), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/Bindtable", data: "{'restroid':'" + restroid + "','sectionID':'" + e + "'}", dataType: "json", async: !1, success: function (e) { var r = 0, i = e.length, t = ""; for (r = 0; r < i; r++) t = t + "<div class='sectionBox'  id='" + e[r].tableId + "' onclick='UpdateTable(" + e[r].tableId + ");'>", t = (t += "<img src='/Content/images/table-icon-sm.png' />") + "<h6>" + e[r].name + "</h6></div>"; jquery_min_p("#sourceFields").append(t) }, error: function () { } }) } function UpdateTable(e) { var r = "#" + e; jquery_min_p(r).hasClass("active") ? jquery_min_p(r).removeClass("active") : jquery_min_p(r).addClass("active") } function AssignNewTable() { var e = jquery_min_p("#lblorderid").val(); restroid = jquery_min_p("#lblrestroid").text(); var r = "<dtXml>", i = 0; $("#sourceFields .sectionBox").each(function (e) { if ($(this).hasClass("active")) { i = 1, r += "<dtXml "; var t = jquery_min_p(this)[0].id; r += 'TableId="' + t + '" ', r += " />" } }), r += "</dtXml>", 1 == i ? jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/AssignNewTable", data: "{'restroid':'" + restroid + "','TableDataX':'" + r + "','Orderid':'" + e + "'}", dataType: "json", async: !1, success: function (e) { e.length > 0 && jquery_min_p("#Tableshift").modal("hide"), jquery_min_p("#popupsuccess").text("Table Shifted Successfully"), jquery_min_p("#savePopup").modal("show") }, error: function () { } }) : (jquery_min_p("#h6warning").text("Please Select Table First"), jquery_min_p("#dngwarn").modal("show")) } function Action_Click(e, r) { e = e; if ("Bumped" != (r = r)) jquery_min_p("#h6warning").text("Item Status Is not Bumped"), jquery_min_p("#dngwarn").modal("show"); else { jquery_min_p("#hconfirm").text("Would You Like To Dilivered This Item !"), jquery_min_p("#confirmationPopup").modal("show"), jquery_min_p("#yesBtn").click(function () { jquery_min_p("#confirmationPopup").modal("hide"), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/Action_Click", data: "{'restroid':'" + restroid + "','orderitemsId':'" + e + "'}", dataType: "json", async: !1, success: function (e) { e.length > 0 ? (jquery_min_p("#popupsuccess").text("Item Is Dilivering"), jquery_min_p("#savePopup").modal("show"), BindRunningOrder()) : alert("Error") }, error: function () { } }) }), jquery_min_p("#noBtn").click(function () { jquery_min_p("#confirmationPopup").modal("hide") }) } } function BillHistory(e) { e = e; restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BillHistory", data: "{'date':'" + e + "','restroid':'" + restroid + "'}", dataType: "json", async: !1, success: function (e) { var r = 0, i = e, t = (e.length, ""); if (i.length > 0) { for (r = 0; r < i.length; r++) t = (t = (t = (t = (t = (t = (t = (t += "<tr>") + "<td style='display:none'>" + i[r].BillNo + "</td>") + "<td>" + i[r].InvoiceNo + "</td>") + "<td>" + i[r].BillAmount + "</td>") + "<td>" + i[r].Billtime + "</td>") + "<td>" + i[r].EmpName + "</td>") + "<td>" + i[r].OrderType + "</td>") + "<td>" + i[r].tableNo + "</td>", t += "</tr>"; jquery_min_p("#tblbillhistoryDetail tbody").append(t) } else { jquery_min_p("#tblbillhistoryDetail tbody tr").remove(); jquery_min_p("#tblbillhistoryDetail tbody").append("<tr><td colspan='7'>'No Record Found..'</td></tr>") } jquery_min_p("#preloader").css("display", "none"), jquery_min_p("#Overlay_Load").css("visibility", "hidden") }, beforesend: function () { jquery_min_p("#preloader").css("display", "block"), jquery_min_p("#Overlay_Load").css("visibility", "visible") }, error: function () { } }) } function Removeclass() { "" != jquery_min_p("#txtBillDate").val() && jquery_min_p("#txtBillDate").removeClass("validate") } function BindPaymentPage() { jquery_min_p("#lblOrderNo").text(); var e = jquery_min_p("#lblorderid").val(); restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BindPaymentPage", data: "{'restroid':'" + restroid + "','orderId':'" + e + "'}", dataType: "json", async: !1, success: function (r) { e = r, window.location.href = "/SalesBilling/Payment/?orderId=" + e }, error: function () { } }) } function btnaddnewitem() { var e = jquery_min_p("#lblorderid").val(); restroid = jquery_min_p("#lblrestroid").text(), jquery_min_p.ajax({ type: "POST", contentType: "application/json; charset=utf-8", url: "/RunningOrder/BindPaymentPage", data: "{'restroid':'" + restroid + "','orderId':'" + e + "'}", dataType: "json", async: !1, success: function (r) { e = r, window.location.href = "3" == checkOrderTypeId ? "/SalesBilling/TakeAway/?orderId=" + e : 0 == IsHoldItem ? "/SalesBilling/DineInTakeAway/?orderId=" + e : "/SalesBilling/DineInTakeAway/?OrderId=" + e }, error: function () { } }) } jquery_min_p(document).ready(function () { restroid = jquery_min_p("#lblrestroid").text(), BindRunningOrder(), jquery_min_p("#empDetails").css("display", "block"), jquery_min_p("#btntableshift").click(function () { BtnTableShift_Click(), jquery_min_p("#Tableshift").modal("show") }), jquery_min_p("#btnSettle").click(function () { var e = 0, r = jquery_min_p("#tblrunningord tbody tr ").length; jquery_min_p("#tblrunningord tbody").find("tr").each(function () { "Delivered" == jquery_min_p(this).closest("tr").find("td:nth-child(4)").text().trim() && (e += 1) }), r == e ? BindPaymentPage() : (jquery_min_p("#h6warning").text("Some Items Are Not Delivered"), jquery_min_p("#dngwarn").modal("show")) }), jquery_min_p("#btnmshowbill").click(function () { "" == jquery_min_p("#txtBillDate").val() ? jquery_min_p("#txtBillDate").addClass("validate") : BillHistory(jquery_min_p("#txtBillDate").val()) }), jquery_min_p("#btnBillHistory").click(function () { jquery_min_p("#billhst").modal("show") }), jquery_min_p("#btnUpdate").click(function () { var e = 0; $("#sourceFields .sectionBox").each(function (r) { if ($(this).hasClass("active")) { e = 1, "<dtXml "; var i = jquery_min_p(this)[0].id; 'TableId="' + i + '" ', " />" } }), 1 == e ? (jquery_min_p("#hconfirm").text("Are You Sure Want To Shift Table"), jquery_min_p("#confirmationPopup").modal("show"), jquery_min_p("#yesBtn").click(function () { jquery_min_p("#confirmationPopup").modal("hide"), AssignNewTable() }), jquery_min_p("#noBtn").click(function () { jquery_min_p("#confirmationPopup").modal("hide"), jquery_min_p("#Tableshift").modal("hide") })) : (jquery_min_p("#h6warning").text("Please Select Table First"), jquery_min_p("#dngwarn").modal("show")) }), jquery_min_p("#btnsaveclose").click(function () { jquery_min_p("#savePopup").modal("hide"), BindRunningOrder() }) });